<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Conceptos básicos cocos2d-x v3.x</title>

    <!-- Bootstrap CSS -->
    <link href="../lib/bootstrap-3.2.0-dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../css/capitulosCSS/capitulo1.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    
    <link rel="shortcut icon" href="../img/index/alienIcon.png">


    <body>
        <!--Nav bar -->
        <nav class="navbar navbar-inverse navbar-fixed-top device-fixed-height">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div id="navbar" class="collapse navbar-collapse device-fixed-width">
                    <ul class="nav navbar-nav">
                        <li><a href="../index.html">Inicio</a>
                        </li>
                        <li>
                            <a href="../tutorialesBasico.html">Índice</a>
                        </li>
                        <li><a href="../contact.html">Contacto</a>
                        </li>
                    </ul>
                </div>
                <!--/.nav-collapse -->
            </div>
        </nav>
        <!--Nav bar end-->


        <div class="container afternav">
            <h1>Capítulo 3 - Conceptos básicos cocos2d-x v3</h1>
            <p>
                En esta sección veremos la estructura básica de una aplicación en cocos2d-x además de algunos elementos esenciales como el tratamiento de los ejes de coordenadas y los elementos principales como Sprite, Layer y Scene. El resto de componentes los dejamos para capítulos posteriores.
            </p>

            <h2>3.1 Estructura</h2>
            <p>
                Creamos el proyecto que usaremos en capítulos siguientes <strong>cocos new SkyHunter -p skyHunter.net.sytes.seryux -l cpp</strong> como ya sabemos SkyHunter será el nombre del proyecto, skyHunter.net.sytes.seryux el nombre de paquete para Android y cpp indica que usaremos el lenguaje de programación C++.
            </p>

           
            <p>
                Una vez creamos el proyecto abrimos la solución de Visual Studio, para ello abrimos el archivo <strong> SkyHunter/proj.win32/SkyHunter.sln </strong>.
                <br/><br/>

                <img class="img-rounded mobile" src="../img/capitulo3/solucionVS.PNG" alt="solucion visual studio" style="width:400px;"/>
                
                <br/><br/>
                Como vemos, en la solución encontramos libcocos2d que es la librería de cocos, también encontramos libbox2d para física y libSpine para skeletal animations en 2d. A lo largo de estos tutoriales usaremos sobre todo libcocos2d.
                <br/>Ahora echaremos un vistazo a src que en realidad se corresponde con la carpeta Classes de nuestro proyecto general de cocos. <strong>(Para crear clases nuevas, las crearemos directamente en la carpeta Classes y posteriormente las vincularemos a esta carpeta de la solución de visual studio para no tener problemas durante la compilación)</strong>. Aquí vemos las clases de la plantilla del proyecto AppDelegate y HelloWorldSene. 
                <br/>
            </p>
            <p>
                <h3>AppDelegate.cpp</h3>
                <iframe  src="../img/capitulo3/AppDelegate.html" width="100%" height="300px">Your Browser doesn't support Frames.</iframe>
                Esta clase <strong>class  AppDelegate : private cocos2d::Application</strong> hereda de Application y es la clase que hará que nuestro juego y escenas sean inicializadas y puestas en ejecución. Aquí vemos que se llama al singleton Director para cargar la escena HelloWorld <strong>director->runWithScene(scene)</strong>.
                <br/> Por el momento no indagaremos mucho más sobre esta clase.
            </p>
            <p>
                <h3>HelloWorldScene.h</h3>
                <iframe  src="../img/capitulo3/HelloWorldScene.html" width="100%" height="300px">Your Browser doesn't support Frames.</iframe>
                Con ver el header de esta clase es suficiente pues la implementación de la plantilla la borraremos y la haremos nosotros mismos. Esta clase hereda de <strong>public cocos2d::Layer</strong> al igual que todas nuestras escenas. Más adelante veremos cómo implementar una escena.
            </p>


            <h2>3.2 Conceptos básicos</h2>
            <h3>Cocos2d-x y C++</h3>
            <p>
                Si tienes experiencia en lenguajes de programación como Java y nunca usaste C++, Cocos te lo pone fácil. Todos los objetos como Sprite o Layer heredan de Node, esto quiere decir que Cocos hace la gestión de memoria por ti. Sin miedos a memory leaks siempre y cuando tus objetos hereden de cocos2d::Node.
            </p>
            <h3>Macros</h3>
            <p>
                Cocos cuenta con una gran cantidad de macros para el preprocesador, algunas de ellas son simples como <strong>USING_NS_CC</strong> que equivale a<strong>using namespace cocos2d</strong>, pero también tenemos algunas un poco más complejas como <strong>CC_SYNTHESIZE</strong> para generar automáticamente getters y setters. Iremos viendo algunas de ellas durante los próximos capítulos</p>
            <h3>Eje de coordenadas</h3>
            <p>
                Cocos tiene un eje de coordenadas como el siguiente:
                <br/>
                <center>
                    <img class="img-rounded" src="../img/capitulo3/portrait.png" alt="eje de coordenadas portrait" style="width:200px;height:300px;"/>
                
                    <img class="img-rounded" src="../img/capitulo3/landscape.png" alt="eje de coordenadas landscape" style="width:320px;height:200px;margin-top:3%;"/>
                </center>
                <br/>
                Está abstraído de tal forma que independientemente de la orientación de nuestro juego, ya sea portrait o landscape, el  {0,0} siempre estará en la parte inferior izquierda de la pantalla. El eje Z se usa para saber qué imagen debe ser dibujada más adelante o más atrás, de tal forma que se verá siempre la imagen cuyo valor para Z sea mayor.
                Este valor de Z se puede cambiar directamente en el nodo en el momento de añadirlo a un nodo padre.
            </p>
            <h3>Anchor point</h3>
            <p>
                El anchor point de un Sprite indica desde donde se realizaran las operaciones como mover o rotar, es decir puedo mover un Sprite o rotarlo desde su centro, desde una esquina o desde donde se le indique a cocos. Basta con cambiar su Anchor Point. El valor por defecto es el centro <strong>mySprite->setAnchorPoint(0.5, 0.5)</strong>  mejor veámoslo gráficamente</p>
            <br/>
             <center><img class="img-rounded " src="../img/capitulo3/anchor.png" alt="eje de coordenadas landscape" style="width:280px;height:280px;"/>
             </center>
             <br/>
             <p>
                Aquí vemos algunas de las posibles combinaciones. El resto de componentes los veremos sobre la marcha en capítulos siguientes.
            </p>
            <h2>3.3 Usando estos tutoriales</h2>
            <p>
                En cada capítulo se aporta un link de descarga del código relativo a cada capítulo. Tan solo crea un proyecto con cocos y reemplaza el contenido de las carpetas <strong>Classes</strong> y <strong>Resources</strong> del proyecto creado por ti con el contenido provisto en los capítulos.
            </p>
            <div class="bs-callout bs-callout-warning" id="callout-dropdown-positioning">
                <h4 id="may-require-additional-positioning">Al compilar en Visual Stududio ...<a class="anchorjs-link" href="#may-require-additional-positioning"><span class="anchorjs-icon"></span></a></h4>
                <p>Recuerda arrastrar los ficheros desde la carpeta Classes a la carpeta src de la solución de Visual Studio para compilarlos. Si ya has compilado algo antes en modo debug, recuerda además eliminar la carpeta *.tlog. Por ejemplo, nuestro poryecto se llama Test, elimina la carpeta Test\proj.win32\Debug.win32\Test.tlog.</p>
            </div>
            <h2>3.4 Usando Sprites</h2>
            <p>
                Lo primero que debemos hacer es copiar las imágenes cuyo link de descarga está arriba, a la carpeta <strong>Resources</strong> y borrar todo su contenido anterior a excepción de la carpeta fonts.
            </p>

            <p>
                Recordar que esta carpeta se encuentra en SkyHunter -> Resources al mismo nivel que la carpeta Classes.
                <br/><br/>
                <img class="img-rounded mobile" src="../img/capitulo3/recursos.png" alt="solucion visual studio" style="width:600px;"/><br/>
            </p>
            <p>
                Ahora que ya tenemos las imagenes incluidas en nuestro proyecto, las podemos utilizar. Para ello usaremos la clase <strong>cocos2d::Sprite</strong> y crearemos a modo de ejemplo el fondo de nuestro juego con <strong>Sprite::create("nombre-imagen")</strong>.
                <br/>
                <img class="img-rounded mobile" src="../img/capitulo3/fondo.png" alt="Añadido fondo al juego" style="width:100%;"/><br/>
            </p>
            <p>
                 Para posicionar el fondo de nuestro juego usamos <strong>fondo->setPosition(visibleSize.width / 2, visibleSize.height / 2)</strong> porque como vimos en el <a href="capitulo12.html">capítulo 2</a> por defecto los sprites tienen su anchor point en el centro entonces como queremos que ocupe toda la pantalla, lo colocamos en el centro de la misma. Cocos automáticamente escalará el sprite gracias a la configuración que pusimos en nuestro AppDelegate.cpp.
            </p>    
            <p>
                Ahora que ya sabemos como funciona la clase Sprite, crearemos las clases para nuestro juego que heredaran de <strong>cocos2d::Sprite</strong> y de <strong>cocos2d::Node</strong>.
                Para comenzar, crearemos una clase Background que se mueva. Para tener sensación de desplazamiento en nuestro juego.
            </p>
                <h3>Background.h</h3>
                <iframe  src="../img/capitulo3/Background.h.html" width="100%" height="300px">Your Browser doesn't support Frames.</iframe>
                <h3>Background.cpp</h3>
                <iframe  src="../img/capitulo3/Background.cpp.html" width="100%" height="300px">Your Browser doesn't support Frames.</iframe><br/><br/>
                <p>
                    Esta clase hereda de Node para poder ser añadida a la escena de cocos, básicamente es un nodo al que se le añaden dos hijos que son dos Sprite simples.<br/>
                    Uno es añadido por encima de la altura de la pantalla por lo que no será visible y otro justo dentro de la pantalla por lo que sí será visible.
                </p>
                <p>
                    En su update se mueven ambos sprites hacia abajo para dar una sensación de movimiento. Una vez que el Sprite que en principio no era visible está situado justo en el centro de la pantalla, se reposiciona a su posición original, de la misma forma el Sprite que al principio estaba situado en el centro de la pantalla es reseteado a su posición inicial cuando ya no es visible al salirse por debajo de la pantalla.<br/> Mejor veámoslo ilustrado.<br/><br/>
                    <center><img class="img-rounded " src="../img/capitulo3/backgroundExpliation.png" alt="expliacion del funcionamiento del background" style="width:300px;"/><br/></center>
                    <br/><br/>
                    También usamos dos macros <strong>CC_SYNTHESIZE</strong> ya nombrada en el capítulo anterior, que nos permite generar rápidamente getters y setters y el segundo macro <strong>CREATE_FUNC</strong> que genera automáticamente el método estático <strong>create()</strong> para esta clase.
                </p>
                <p>
                    Excelente, ahora sólo falta decirle a nuestro juego que añada el nuevo background en lugar del que teníamos inicialmente y hacer que este background se mueva.
                </p>
                 <h3>GameLayer.h</h3>
                <iframe  src="../img/capitulo3/GameLayer2.h.html" width="100%" height="300px">Your Browser doesn't support Frames.</iframe>
                <h3>GameLayer.cpp</h3>
                <iframe  src="../img/capitulo3/GameLayer2.cpp.html" width="100%" height="300px">Your Browser doesn't support Frames.</iframe>
                <br/><br/>
                <p>
                    Como podemos ver, hemos creado un método update y le decimos al framework que incluya en el ciclo del juego ese método update mediante <strong>this->schedule(schedule_selector(GameLayer::update))</strong> (no es necesario que el método se llame update pero sí que reciba un float como parámetro y sea void), 
                    <strong>schedule_selector</strong> es uno de esos macros especiales que cocos2d-x incluye para facilitar el desarrollo de nuestro juego.
                    En el <strong>update</strong> recibiremos como parámetro la cantidad de tiempo que transcurrió desde la última vez que se ejecutó. Para garantizar que el juego trabaja siempre a la misma velocidad, multiplicaremos la velocidad a la que se mueven todos los elementos por <strong>dt</strong> tal y como hicimos en el método update de la clase <strong>Background</strong> que es llamado desde aquí al igual que todos los métodos update de los diferentes componentes que iremos creando.
                </p>
                <p>
                    Puedes descargar las carpetas Classes y Resources del proyecto hasta el momento <a href="../img/capitulo3/SkyHunter3.2.zip">aquí</a>. 
                </p>
            <!-- end container -->
        </div>

        <!-- next chapter link -->
        <div>
            <br/>
            <center>
                <a  href="capitulo2.html" >
                    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Capítulo anterior
                </a>
                |
                <a  href="capitulo4.html" >
                    Capítulo siguiente <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span> 
                </a>
            </center>
            <br/>
        </div>


        <!-- BOOTSTRAP CORE JS -->
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="../js/jquery-1.11.1.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="../lib/bootstrap-3.2.0-dist/js/bootstrap.min.js"></script>
        <script>
            // from https://signalvnoise.com/posts/2407-device-scale-user-interface-elements-in-ios-mobile-safari
            function getDeviceScale() {
                var deviceWidth, landscape = Math.abs(window.orientation) == 90;
                if (landscape) {
                  // iPhone OS < 3.2 reports a screen height of 396px
                  deviceWidth = Math.max(480, screen.height);
                } else {
                  deviceWidth = screen.width;
                }
                return window.innerWidth / deviceWidth;
            }

            // mobile only - keep the position:fixed header at constant size when page is zoomed
            if (navigator.userAgent.match(/Mobi/)) {
                $(window).on('load scroll', function() {
                    var ds = getDeviceScale();
                    $('.device-fixed-height').css('transform','scale(1,' + ds + ')')
                        .css('transform-origin', '0 0');
                    $('.device-fixed-width').css('transform', 'scale(' + ds + ',1)')
                        .css('transform-origin', '0 0');
                    })
            }
        </script>
         <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-63954706-1', 'auto');
            ga('send', 'pageview');
        </script>
    </body>

</html>